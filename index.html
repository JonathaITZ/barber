<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don Barber - Premium Grooming</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Roboto+Slab:wght@700;900&display=swap');
        
        :root {
            --brand-navy: #0f172a;
            --transition-speed: 0.6s;
            --ease: cubic-bezier(0.23, 1, 0.32, 1);
        }

        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            transition: background-color 0.5s var(--ease), color 0.5s var(--ease);
        }

        .font-logo { font-family: 'Roboto Slab', serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Slider Horizontal de Passos */
        .step-container {
            display: flex;
            transition: transform var(--transition-speed) var(--ease);
            width: 500%; 
        }

        .step-item {
            width: 20%;
            flex-shrink: 0;
            padding: 0 16px;
            height: 100%;
        }

        /* Efeitos de Feedback */
        .press-effect {
            transition: transform 0.2s var(--ease);
        }
        .press-effect:active {
            transform: scale(0.97);
        }

        .theme-icon-swap {
            animation: iconRotate 0.5s var(--ease) forwards;
        }

        @keyframes iconRotate {
            0% { transform: rotate(-90deg) scale(0); opacity: 0; }
            100% { transform: rotate(0deg) scale(1); opacity: 1; }
        }

        /* Estilos Glassmorphism */
        .glass-dark {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .glass-light {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(15, 23, 42, 0.05);
            box-shadow: 0 10px 30px -10px rgba(15, 23, 42, 0.1);
        }

        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="time"]::-webkit-calendar-picker-indicator { 
            filter: var(--calendar-filter); 
        }

        /* Toggle Switch Estilizado */
        .switch { position: relative; display: inline-block; width: 44px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider-toggle {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #cbd5e1; transition: .4s; border-radius: 34px;
        }
        .slider-toggle:before {
            position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider-toggle { background-color: #0f172a; }
        input:checked + .slider-toggle:before { transform: translateX(22px); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        const SUPABASE_URL = "https://qokhszjgkzcsauvkdlia.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFva2hzempna3pjc2F1dmtkbGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1ODM4MDgsImV4cCI6MjA4NzE1OTgwOH0.IfqVxnwux81PXVAqhDe7ftRXePHM4cmg3w6VHTN53n8";
        
        const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const ADMIN_PIN = "1234";

        const Icon = ({ name, size = 20, className = "" }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (window.lucide && ref.current) {
                    ref.current.innerHTML = `<i data-lucide="${name}" width="${size}" height="${size}" class="${className}"></i>`;
                    window.lucide.createIcons({ root: ref.current });
                }
            }, [name, size, className]);
            return <span ref={ref} style={{ display: 'inline-flex', width: size, height: size }} />;
        };

        function App() {
            const [view, setView] = useState('user'); 
            const [step, setStep] = useState(1);
            const [adminTab, setAdminTab] = useState('agenda');
            const [isDarkMode, setIsDarkMode] = useState(false);
            
            const [bookings, setBookings] = useState([]);
            const [services, setServices] = useState([]);
            const [config, setConfig] = useState({ 
                maxPerSlot: 2, 
                openTime: '09:00', 
                closeTime: '19:00', 
                isManualClosed: false, 
                whatsapp: '' 
            });
            
            const [pinInput, setPinInput] = useState('');
            const [showPinModal, setShowPinModal] = useState(false);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const [selection, setSelection] = useState({ services: [], date: '', time: '', name: '', phone: '' });
            const [newService, setNewService] = useState({ name: '', price: '', duration: '' });

            const fetchData = useCallback(async () => {
                try {
                    const [resBookings, resServices, resSettings] = await Promise.all([
                        client.from('bookings').select('*').order('date', { ascending: true }),
                        client.from('services').select('*').order('name', { ascending: true }),
                        client.from('settings').select('*').eq('id', 'global').maybeSingle()
                    ]);
                    setBookings(resBookings.data || []);
                    setServices(resServices.data || []);
                    if (resSettings.data) setConfig(resSettings.data);
                } catch (err) { console.error(err); }
            }, []);

            useEffect(() => {
                fetchData();
                const channel = client.channel('db-updates')
                    .on('postgres_changes', { event: '*', schema: 'public' }, fetchData)
                    .subscribe();
                return () => client.removeChannel(channel);
            }, [fetchData]);

            useEffect(() => {
                document.body.style.backgroundColor = isDarkMode ? "#020617" : "#f8fafc";
                document.body.style.color = isDarkMode ? "#f1f5f9" : "#0f172a";
                document.documentElement.style.setProperty('--calendar-filter', isDarkMode ? 'invert(1)' : 'invert(0)');
            }, [isDarkMode]);

            const timeSlots = useMemo(() => {
                const slots = [];
                const startHour = parseInt((config.openTime || '09:00').split(':')[0]);
                const endHour = parseInt((config.closeTime || '19:00').split(':')[0]);
                
                for (let i = startHour; i < endHour; i++) {
                    slots.push(`${i.toString().padStart(2, '0')}:00`);
                }
                return slots;
            }, [config.openTime, config.closeTime]);

            const formatPrice = (price) => {
                if (!price) return "R$ 0,00";
                const clean = price.toString().replace('R$', '').trim();
                return `R$ ${clean}`;
            };

            const getVagasDisponiveis = (date, time) => {
                const ocupados = bookings.filter(b => b.date === date && b.time === time).length;
                return (Number(config.maxPerSlot) || 2) - ocupados;
            };

            const totalValue = useMemo(() => {
                return selection.services.reduce((acc, s) => {
                    const val = parseFloat(s.price.toString().replace(/[^\d,.]/g, '').replace(',', '.') || 0);
                    return acc + val;
                }, 0);
            }, [selection.services]);

            const handleBooking = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    const { error } = await client.from('bookings').insert([{
                        name: selection.name, phone: selection.phone, date: selection.date, time: selection.time,
                        service: { items: selection.services.map(s => ({ name: s.name, price: s.price })), total: totalValue }
                    }]);
                    if (error) throw error;
                    setStep(5);
                } catch (err) { setError("Erro ao processar reserva."); }
                finally { setLoading(false); }
            };

            const updateSettings = async (updates) => {
                const newConfig = { ...config, ...updates };
                setConfig(newConfig);
                await client.from('settings').upsert({ id: 'global', ...newConfig });
            };

            const deleteBooking = async (id) => {
                await client.from('bookings').delete().eq('id', id);
                fetchData();
            };

            const sendWhatsApp = () => {
                const clean = (config.whatsapp || '').replace(/\D/g, '');
                const final = clean.startsWith('55') ? clean : `55${clean}`;
                const list = selection.services.map(s => s.name).join(", ");
                const msg = `Agendamento Don Barber:\n\n‚úÇ ${list}\nüìÖ ${selection.date}\n‚è∞ ${selection.time}\nüë§ ${selection.name}\nüí∞ Total: R$ ${totalValue.toFixed(2)}`;
                window.open(`https://wa.me/${final}?text=${encodeURIComponent(msg)}`, '_blank');
            };

            const glassClass = isDarkMode ? "glass-dark" : "glass-light";
            const textContrast = isDarkMode ? "text-white" : "text-slate-950";
            const subTextContrast = isDarkMode ? "text-slate-400" : "text-slate-500";
            const accentBtn = isDarkMode ? "bg-white text-slate-950" : "bg-slate-900 text-white";

            return (
                <div className="min-h-screen max-w-[500px] mx-auto flex flex-col relative overflow-hidden transition-all duration-500 border-x border-slate-200 dark:border-white/5 shadow-2xl">
                    
                    {/* Cabe√ßalho */}
                    <header className={`p-6 backdrop-blur-xl border-b z-50 sticky top-0 transition-all duration-500 ${isDarkMode ? 'bg-slate-900/40 border-white/5' : 'bg-white/60 border-slate-200'}`}>
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <div className="relative">
                                    <div className="w-12 h-12 rounded-full border-2 border-slate-900 dark:border-white bg-white p-1 shadow-sm overflow-hidden flex items-center justify-center">
                                        <Icon name="scissors" size={24} className="text-slate-900" />
                                    </div>
                                    <div className={`absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 rounded-full border-2 border-white dark:border-slate-900 ${config.isManualClosed ? 'bg-red-500' : 'bg-green-500'}`}></div>
                                </div>
                                <div>
                                    <h1 className={`text-xl font-logo uppercase tracking-tighter leading-none ${textContrast}`}>Don <span className="opacity-40">Barber</span></h1>
                                    <p className={`text-[9px] font-bold uppercase tracking-[0.2em] mt-1.5 ${subTextContrast}`}>
                                        {config.isManualClosed ? 'Loja Fechada' : 'Navy Standard'}
                                    </p>
                                </div>
                            </div>

                            <button 
                                onClick={() => setIsDarkMode(!isDarkMode)}
                                className={`w-11 h-11 rounded-2xl flex items-center justify-center transition-all press-effect border ${isDarkMode ? 'bg-slate-800 border-white/10 text-white' : 'bg-white border-slate-200 text-slate-900 shadow-sm'}`}
                            >
                                <div key={isDarkMode ? 'sun' : 'moon'} className="theme-icon-swap">
                                    <Icon name={isDarkMode ? "sun" : "moon"} size={20} />
                                </div>
                            </button>
                        </div>
                    </header>

                    <main className="flex-1 flex flex-col overflow-hidden">
                        {config.isManualClosed && view === 'user' ? (
                            /* Ecr√£ de Loja Fechada */
                            <div className="flex-1 flex flex-col items-center justify-center p-10 text-center animate-in zoom-in">
                                <div className="w-24 h-24 bg-red-500/10 text-red-500 rounded-full flex items-center justify-center mb-6 shadow-xl border-2 border-red-500/20">
                                    <Icon name="power-off" size={40} />
                                </div>
                                <h2 className={`text-3xl font-logo uppercase italic mb-4 leading-none ${textContrast}`}>Estamos em Pausa</h2>
                                <p className={`${subTextContrast} text-sm font-medium leading-relaxed italic`}>
                                    De momento n√£o estamos a aceitar agendamentos online. Por favor, tente novamente mais tarde ou contacte-nos.
                                </p>
                                <button onClick={() => window.open(`https://wa.me/${config.whatsapp}`)} className="mt-10 px-8 py-4 bg-green-500 text-white font-logo rounded-2xl uppercase text-[10px] tracking-widest flex items-center gap-3">
                                    <Icon name="message-circle" /> Contactar Suporte
                                </button>
                            </div>
                        ) : view === 'user' ? (
                            <div className="flex-1 overflow-hidden">
                                <div className="step-container h-full" style={{ transform: `translateX(-${(step - 1) * 20}%)` }}>
                                    
                                    {/* PASSO 1: SERVI√áOS */}
                                    <div className="step-item p-4">
                                        <div className={`${glassClass} rounded-[2.5rem] p-6 h-full overflow-y-auto no-scrollbar transition-all`}>
                                            <div className="mb-8 px-2">
                                                <h2 className={`text-2xl font-logo uppercase tracking-tight ${textContrast}`}>Servi√ßos</h2>
                                                <p className={`${subTextContrast} text-xs font-bold uppercase tracking-widest mt-1`}>O que faremos hoje?</p>
                                            </div>
                                            
                                            <div className="grid gap-4 pb-4">
                                                {services.map(s => {
                                                    const sel = selection.services.find(i => i.id === s.id);
                                                    return (
                                                        <button key={s.id} onClick={() => {
                                                            setSelection(p => sel ? {...p, services: p.services.filter(i => i.id !== s.id)} : {...p, services: [...p.services, s]});
                                                        }} className={`w-full flex items-center justify-between p-5 rounded-[1.75rem] border-2 transition-all duration-300 press-effect text-left ${sel ? 'border-slate-950 dark:border-white bg-slate-900/5 dark:bg-white/5' : 'bg-transparent border-slate-100 dark:border-white/5'}`}>
                                                            <div className="flex items-center gap-4">
                                                                <div className={`p-3.5 rounded-2xl transition-all duration-300 ${sel ? (isDarkMode ? 'bg-white text-slate-900 shadow-xl' : 'bg-slate-950 text-white shadow-xl') : 'bg-slate-50 dark:bg-slate-800 text-slate-300'}`}><Icon name={sel ? "check" : "plus"} size={18} /></div>
                                                                <div><p className={`font-bold text-base leading-none tracking-tight ${textContrast}`}>{s.name}</p><p className="text-[10px] text-slate-400 mt-2 font-black uppercase tracking-tighter italic">{s.duration}</p></div>
                                                            </div>
                                                            <span className={`font-logo text-lg ${textContrast}`}>{formatPrice(s.price)}</span>
                                                        </button>
                                                    );
                                                })}
                                            </div>
                                            {selection.services.length > 0 && (
                                                <button onClick={() => setStep(2)} className={`w-full py-5 ${accentBtn} font-logo rounded-[1.5rem] mt-4 shadow-2xl press-effect uppercase text-sm tracking-widest italic transition-all`}>Seguinte (R$ {totalValue.toFixed(2)})</button>
                                            )}
                                        </div>
                                    </div>

                                    {/* PASSO 2: DATA */}
                                    <div className="step-item p-4">
                                        <div className={`${glassClass} rounded-[2.5rem] p-10 text-center h-full flex flex-col justify-center transition-all border-2 border-slate-950/5 dark:border-white/5`}>
                                            <div className="w-16 h-16 bg-slate-950/5 dark:bg-white/10 text-slate-950 dark:text-white rounded-3xl flex items-center justify-center mx-auto mb-8 border border-slate-950/10 dark:border-white/20"><Icon name="calendar" size={30} /></div>
                                            <h2 className={`text-2xl font-logo uppercase mb-8 ${textContrast}`}>Data da Reserva</h2>
                                            <input type="date" min={new Date().toISOString().split('T')[0]} className={`w-full p-6 rounded-[1.5rem] border-2 font-logo text-xl text-center [color-scheme:dark] mb-10 transition-all ${isDarkMode ? 'bg-slate-800 border-white/10 text-white' : 'bg-white border-slate-200 text-slate-950 shadow-inner'}`} onChange={e => setSelection({...selection, date: e.target.value})} />
                                            <button onClick={() => setStep(3)} disabled={!selection.date} className={`w-full py-5 ${accentBtn} font-logo rounded-[1.5rem] shadow-xl press-effect uppercase tracking-widest`}>Ver Hor√°rios</button>
                                            <button onClick={() => setStep(1)} className="mt-8 text-slate-400 font-black uppercase text-[10px] tracking-[0.3em] hover:text-slate-950 transition-colors italic">Alterar Menu</button>
                                        </div>
                                    </div>

                                    {/* PASSO 3: HOR√ÅRIOS DIN√ÇMICOS */}
                                    <div className="step-item p-4">
                                        <div className={`${glassClass} rounded-[2.5rem] p-6 h-full overflow-y-auto no-scrollbar transition-all`}>
                                            <h2 className={`text-xl font-logo uppercase mb-8 text-center tracking-tight ${textContrast}`}>Janelas Dispon√≠veis</h2>
                                            <div className="grid grid-cols-2 gap-4 pb-10">
                                                {timeSlots.map(t => {
                                                    const v = getVagasDisponiveis(selection.date, t);
                                                    const off = v <= 0;
                                                    return (
                                                        <button key={t} disabled={off} onClick={() => {setSelection({...selection, time: t}); setStep(4)}} 
                                                            className={`py-6 rounded-[1.5rem] border-2 font-logo text-lg relative transition-all press-effect ${off ? 'bg-slate-100 dark:bg-slate-900 border-slate-200 dark:border-white/5 text-slate-300 opacity-40 shadow-inner' : (isDarkMode ? 'bg-slate-800/80 border-transparent text-white active:bg-white active:text-slate-900' : 'bg-white border-slate-100 text-slate-900 active:bg-slate-950 active:text-white shadow-sm')}`}>
                                                            {t} {!off && <span className="absolute top-1.5 right-3 text-[7px] text-slate-400 font-black uppercase tracking-widest">{v} Vagas</span>}
                                                        </button>
                                                    );
                                                })}
                                            </div>
                                            <button onClick={() => setStep(2)} className="w-full text-slate-400 font-black uppercase text-[9px] tracking-[0.3em] mt-2 mb-6 italic">Alterar Data</button>
                                        </div>
                                    </div>

                                    {/* PASSO 4: FORMUL√ÅRIO */}
                                    <div className="step-item p-4">
                                        <div className={`${glassClass} rounded-[2.5rem] p-8 space-y-8 h-full overflow-y-auto no-scrollbar transition-all`}>
                                            <h2 className={`text-2xl font-logo uppercase ${textContrast}`}>Dados Finais</h2>
                                            <div className="space-y-6">
                                                <div className="space-y-2">
                                                    <label className={`text-[10px] font-black uppercase px-4 tracking-[0.2em] ${subTextContrast}`}>Nome Completo</label>
                                                    <input required placeholder="Quem atendemos?" className={`w-full p-5 rounded-[1.5rem] border-2 outline-none focus:border-slate-950 dark:focus:border-white font-bold transition-all ${isDarkMode ? 'bg-slate-800 border-white/5 text-white' : 'bg-slate-50 border-slate-100 text-slate-950 shadow-inner'}`} onChange={e => setSelection({...selection, name: e.target.value})} />
                                                </div>
                                                <div className="space-y-2">
                                                    <label className={`text-[10px] font-black uppercase px-4 tracking-[0.2em] ${subTextContrast}`}>WhatsApp (DDD + N¬∞)</label>
                                                    <input required type="tel" placeholder="83 99999-9999" className={`w-full p-5 rounded-[1.5rem] border-2 outline-none focus:border-slate-950 dark:focus:border-white font-bold transition-all ${isDarkMode ? 'bg-slate-800 border-white/5 text-white' : 'bg-slate-50 border-slate-100 text-slate-950 shadow-inner'}`} value={selection.phone} onChange={e => setSelection({...selection, phone: e.target.value.replace(/\D/g, '').slice(0,11)})} />
                                                </div>
                                            </div>
                                            <button onClick={handleBooking} disabled={loading || selection.phone.length < 10 || !selection.name} className={`w-full py-5 ${accentBtn} font-logo rounded-[1.5rem] shadow-2xl press-effect uppercase tracking-widest italic transition-all`}>Validar Agendamento</button>
                                        </div>
                                    </div>

                                    {/* PASSO 5: SUCESSO */}
                                    <div className="step-item p-4">
                                        <div className={`${glassClass} rounded-[2.5rem] p-10 text-center h-full flex flex-col justify-center items-center transition-all border-2 border-slate-950/10 dark:border-white/5`}>
                                            <div className="relative mb-10">
                                                <div className={`w-24 h-24 rounded-full flex items-center justify-center shadow-xl border-4 ${isDarkMode ? 'bg-green-500 border-slate-900' : 'bg-green-500 border-white'}`}><Icon name="check" size={48} className="text-white" /></div>
                                                <div className="absolute -inset-4 bg-green-500/10 blur-2xl rounded-full -z-10"></div>
                                            </div>
                                            <h2 className={`text-3xl font-logo uppercase mb-3 tracking-tighter leading-none ${textContrast}`}>Reservado!</h2>
                                            <p className={`${subTextContrast} text-sm mb-12 max-w-[220px] font-medium leading-relaxed italic`}>O teu lugar na cadeira est√° garantido. Estaremos √† tua espera.</p>
                                            <button onClick={sendWhatsApp} className="w-full py-5 bg-[#128C7E] text-white font-logo rounded-[1.5rem] shadow-xl press-effect flex items-center justify-center gap-3 tracking-widest uppercase italic">
                                                <Icon name="message-circle" /> Confirmar no WhatsApp
                                            </button>
                                            <button onClick={() => window.location.reload()} className="mt-10 text-slate-400 font-black uppercase text-[10px] tracking-[0.4em] hover:text-slate-950 transition-colors">Novo Agendamento</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            /* PAINEL STAFF RESPONSIVO */
                            <div className="flex-1 p-6 overflow-y-auto no-scrollbar fade-in space-y-8 pb-24">
                                <div className={`flex p-1.5 rounded-[1.5rem] border shadow-inner transition-all ${isDarkMode ? 'bg-slate-900/60 border-white/5' : 'bg-slate-100 border-slate-200'}`}>
                                    {['agenda', 'servicos', 'loja'].map(t => (
                                        <button key={t} onClick={() => setAdminTab(t)} className={`flex-1 py-3 rounded-xl font-logo text-[10px] uppercase transition-all duration-300 ${adminTab === t ? (isDarkMode ? 'bg-white text-slate-950 shadow-lg' : 'bg-slate-950 text-white shadow-lg') : isDarkMode ? 'text-slate-600' : 'text-slate-400'}`}>
                                            {t === 'loja' ? 'Gest√£o' : t}
                                        </button>
                                    ))}
                                </div>

                                {adminTab === 'loja' && (
                                    <div className="space-y-6 animate-in slide-in-from-bottom-4">
                                        {/* CONTROLO DE ABERTURA E FECHO MANUAL */}
                                        <div className={`${glassClass} p-8 rounded-[2.5rem] border-2 ${config.isManualClosed ? 'border-red-500/30' : 'border-green-500/30'}`}>
                                            <div className="flex items-center justify-between mb-4">
                                                <div>
                                                    <h3 className={`text-sm font-logo uppercase tracking-tight ${textContrast}`}>Status da Barbearia</h3>
                                                    <p className={`text-[10px] font-black uppercase italic ${config.isManualClosed ? 'text-red-500' : 'text-green-500'}`}>
                                                        {config.isManualClosed ? 'Loja Fechada Manualmente' : 'Loja Operacional'}
                                                    </p>
                                                </div>
                                                <label className="switch">
                                                    <input type="checkbox" checked={!config.isManualClosed} onChange={e => updateSettings({ isManualClosed: !e.target.checked })} />
                                                    <span className="slider-toggle"></span>
                                                </label>
                                            </div>
                                            <p className="text-[9px] text-slate-400 font-medium italic leading-relaxed">
                                                Use este interruptor para fechar a loja instantaneamente em feriados ou imprevistos. Clientes ver√£o uma mensagem de pausa.
                                            </p>
                                        </div>

                                        {/* HOR√ÅRIOS DE FUNCIONAMENTO */}
                                        <div className={`${glassClass} p-8 rounded-[2.5rem] space-y-6 shadow-xl`}>
                                            <div className="flex items-center gap-3 px-2">
                                                <Icon name="clock" size={18} className="text-slate-950 dark:text-white" />
                                                <h3 className={`text-[11px] font-logo uppercase tracking-widest ${textContrast}`}>Janela de Atendimento</h3>
                                            </div>
                                            <div className="grid grid-cols-2 gap-6">
                                                <div className="space-y-2">
                                                    <label className="text-[8px] font-black text-slate-400 uppercase px-4 tracking-[0.2em]">In√≠cio</label>
                                                    <input type="time" className={`w-full p-4 rounded-2xl border-2 font-logo text-lg [color-scheme:dark] outline-none transition-all ${isDarkMode ? 'bg-slate-800 border-white/5 text-white' : 'bg-white border-slate-200 text-slate-950'}`} value={config.openTime || '09:00'} onChange={e => updateSettings({ openTime: e.target.value })} />
                                                </div>
                                                <div className="space-y-2">
                                                    <label className="text-[8px] font-black text-slate-400 uppercase px-4 tracking-[0.2em]">Fim</label>
                                                    <input type="time" className={`w-full p-4 rounded-2xl border-2 font-logo text-lg [color-scheme:dark] outline-none transition-all ${isDarkMode ? 'bg-slate-800 border-white/5 text-white' : 'bg-white border-slate-200 text-slate-950'}`} value={config.closeTime || '19:00'} onChange={e => updateSettings({ closeTime: e.target.value })} />
                                                </div>
                                            </div>
                                            <p className="text-[8px] text-slate-400 font-bold uppercase italic text-center">Os hor√°rios para o cliente ser√£o gerados entre este intervalo.</p>
                                        </div>

                                        <div className={`${glassClass} p-8 rounded-[2.5rem] space-y-5 shadow-lg`}>
                                            <div className="flex justify-between items-center"><p className={`font-logo uppercase text-[11px] ${textContrast}`}>Cadeiras Simult√¢neas</p><span className={`text-4xl font-logo leading-none ${textContrast}`}>{config.maxPerSlot}</span></div>
                                            <input type="range" min="1" max="10" value={config.maxPerSlot} onChange={e => updateSettings({ maxPerSlot: parseInt(e.target.value) })} className="w-full accent-slate-950 dark:accent-white" />
                                        </div>

                                        <div className={`${glassClass} p-8 rounded-[2.5rem] space-y-4 shadow-xl`}>
                                            <div className="flex items-center gap-3 px-2">
                                                <Icon name="phone" size={18} className="text-slate-950 dark:text-white" />
                                                <h3 className={`text-[11px] font-logo uppercase tracking-widest ${textContrast}`}>WhatsApp Barbearia</h3>
                                            </div>
                                            <input className={`w-full p-5 rounded-[1.5rem] border-2 font-logo text-lg ${isDarkMode ? 'bg-slate-800 border-white/5 text-white' : 'bg-white border-slate-100 text-slate-950 shadow-inner'}`} value={config.whatsapp} onChange={e => updateSettings({ whatsapp: e.target.value.replace(/\D/g, '') })} />
                                        </div>
                                    </div>
                                )}

                                {adminTab === 'agenda' && (
                                    <div className="space-y-4">
                                        <h2 className={`text-xl font-logo uppercase tracking-tight ${textContrast} px-2`}>Fluxo de Hoje</h2>
                                        {bookings.length === 0 ? <p className="text-center py-20 opacity-20 italic">Sem reservas at√© agora.</p> : 
                                            bookings.map(b => (
                                                <div key={b.id} className={`${glassClass} p-6 rounded-[2rem] flex items-center justify-between shadow-lg`}>
                                                    <div className="flex items-center gap-5">
                                                        <div className={`w-12 h-12 rounded-2xl flex items-center justify-center font-logo text-xl border-2 ${isDarkMode ? 'bg-slate-800 border-white/10 text-white' : 'bg-white border-slate-200 text-slate-950'}`}>{b.time?.split(':')[0]}</div>
                                                        <div><p className={`font-bold uppercase text-sm ${textContrast}`}>{b.name}</p><p className={`${subTextContrast} text-[10px] italic`}>{b.date} ‚Ä¢ {b.time}</p></div>
                                                    </div>
                                                    <button onClick={() => deleteBooking(b.id)} className="p-3 bg-red-500/10 text-red-500 rounded-2xl"><Icon name="trash-2" size={16}/></button>
                                                </div>
                                            ))
                                        }
                                    </div>
                                )}

                                {adminTab === 'servicos' && (
                                    <div className="space-y-6">
                                        <div className={`${glassClass} p-7 rounded-[2.5rem] space-y-4 shadow-xl`}>
                                            <h3 className={`text-[10px] font-black uppercase px-2 tracking-widest italic ${subTextContrast}`}>+ Novo Servi√ßo</h3>
                                            <input placeholder="Ex: Degrad√™ Navalhado" className={`w-full p-4 rounded-2xl border-2 text-sm outline-none focus:border-slate-900 dark:focus:border-white font-bold transition-all ${isDarkMode ? 'bg-slate-800 border-white/5 text-white' : 'bg-slate-50 border-slate-200 text-slate-900'}`} value={newService.name} onChange={e => setNewService({...newService, name: e.target.value})} />
                                            <div className="grid grid-cols-2 gap-4">
                                                <input placeholder="R$ 45" className={`w-full p-4 rounded-2xl border-2 text-sm outline-none ${isDarkMode ? 'bg-slate-800 border-white/5 text-white' : 'bg-slate-50 border-slate-200 text-slate-900'}`} value={newService.price} onChange={e => setNewService({...newService, price: e.target.value})} />
                                                <input placeholder="40 min" className={`w-full p-4 rounded-2xl border-2 text-sm outline-none ${isDarkMode ? 'bg-slate-800 border-white/5 text-white' : 'bg-slate-50 border-slate-200 text-slate-900'}`} value={newService.duration} onChange={e => setNewService({...newService, duration: e.target.value})} />
                                            </div>
                                            <button onClick={async () => { if(!newService.name) return; await client.from('services').insert([newService]); fetchData(); setNewService({name:'',price:'',duration:''}); }} className={`w-full py-4 ${accentBtn} font-logo rounded-2xl uppercase text-[10px] tracking-widest`}>Gravar Servi√ßo</button>
                                        </div>
                                        <div className="grid gap-3">
                                            {services.map(s => (
                                                <div key={s.id} className={`${glassClass} p-5 rounded-[1.75rem] flex justify-between items-center px-8 border-l-4 border-slate-950 dark:border-white`}>
                                                    <div><p className={`font-bold text-sm tracking-tight ${textContrast}`}>{s.name}</p><p className="text-[10px] text-slate-400 font-bold uppercase italic">{s.price}</p></div>
                                                    <button onClick={async () => { await client.from('services').delete().eq('id', s.id); fetchData(); }} className="p-3 bg-red-500/10 text-red-500 rounded-2xl"><Icon name="trash-2" size={16}/></button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* Navbar Est√°tica */}
                    <nav className={`p-5 backdrop-blur-3xl border-t flex justify-around items-center z-50 transition-all duration-500 ${isDarkMode ? 'bg-slate-950/90 border-white/5 shadow-2xl' : 'bg-white border-slate-200 shadow-inner'}`}>
                        <button onClick={() => {setView('user'); setStep(1)}} className={`flex flex-col items-center gap-1.5 transition-all duration-300 press-effect ${view === 'user' ? (isDarkMode ? 'text-white scale-110' : 'text-slate-950 scale-110') : 'text-slate-400'}`}><Icon name="calendar-days" size={24} /><span className="text-[8px] font-black uppercase tracking-widest italic font-logo">Agendar</span></button>
                        <div className="w-px h-8 bg-slate-500/10"></div>
                        <button onClick={() => setShowPinModal(true)} className={`flex flex-col items-center gap-1.5 transition-all duration-300 press-effect ${view === 'admin' ? (isDarkMode ? 'text-white scale-110' : 'text-slate-950 scale-110') : 'text-slate-400'}`}><Icon name="layout-dashboard" size={24} /><span className="text-[8px] font-black uppercase tracking-widest italic font-logo">Staff</span></button>
                    </nav>

                    {/* Modal PIN */}
                    {showPinModal && (
                        <div className="fixed inset-0 z-[100] bg-slate-950/95 flex items-center justify-center p-6 backdrop-blur-2xl transition-all">
                            <div className="w-full max-w-xs text-center space-y-12 animate-in zoom-in duration-300">
                                <div className="w-20 h-20 bg-white text-slate-950 rounded-full flex items-center justify-center mx-auto border-4 border-slate-950 shadow-2xl shadow-white/5"><Icon name="shield-check" size={32} /></div>
                                <h3 className="text-2xl font-logo uppercase italic tracking-tight text-white">Privado Staff</h3>
                                <input type="password" inputMode="numeric" maxLength={4} autoFocus className="w-full bg-transparent border-b-4 border-white py-6 text-center text-5xl font-logo tracking-[0.6em] outline-none text-white transition-all focus:border-slate-400" 
                                    onChange={e => { if (e.target.value === ADMIN_PIN) { setView('admin'); setShowPinModal(false); fetchData(); } }} 
                                />
                                <button onClick={() => setShowPinModal(false)} className="text-slate-500 font-black uppercase text-[10px] tracking-[0.4em] hover:text-white transition-colors italic">Voltar</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
