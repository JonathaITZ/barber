<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don Barber - Agendamento Premium</title>
    
    <!-- Tailwind CSS para Estiliza√ß√£o -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React e Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Supabase JS Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            background-color: #09090b;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="time"]::-webkit-calendar-picker-indicator { filter: invert(1); }
        
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        .btn-primary {
            background-color: #f59e0b;
            color: #000;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.2s;
        }
        .btn-primary:active { transform: scale(0.95); }
        .btn-primary:disabled { 
            background-color: #3f3f46;
            color: #71717a;
            transform: scale(1);
            cursor: not-allowed;
        }

        .service-card-selected {
            border-color: #f59e0b !important;
            background-color: rgba(245, 158, 11, 0.1) !important;
        }

        /* Toggle Switch Customizado */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #27272a;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px; width: 18px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: #f59e0b; }
        input:checked + .slider:before { transform: translateX(24px); }
    </style>
</head>
<body class="text-zinc-100">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        // --- CONFIGURA√á√ÉO SUPABASE ---
        const SUPABASE_URL = "https://qokhszjgkzcsauvkdlia.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFva2hzempna3pjc2F1dmtkbGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1ODM4MDgsImV4cCI6MjA4NzE1OTgwOH0.IfqVxnwux81PXVAqhDe7ftRXePHM4cmg3w6VHTN53n8";
        
        const { createClient } = supabase;
        const client = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const ADMIN_PIN = "1234";

        const Icon = ({ name, size = 20, className = "" }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (window.lucide && ref.current) {
                    ref.current.innerHTML = `<i data-lucide="${name}" width="${size}" height="${size}" class="${className}"></i>`;
                    window.lucide.createIcons({ root: ref.current });
                }
            }, [name, size, className]);
            return <span ref={ref} style={{ display: 'inline-flex', width: size, height: size }} />;
        };

        function App() {
            const [view, setView] = useState('user'); 
            const [adminTab, setAdminTab] = useState('agenda'); 
            const [step, setStep] = useState(1);
            
            const [bookings, setBookings] = useState([]);
            const [services, setServices] = useState([]);
            const [config, setConfig] = useState({ 
                maxPerSlot: 2, 
                openTime: '09:00', 
                closeTime: '19:00', 
                isManualClosed: false,
                whatsapp: ''
            });
            
            const [pinInput, setPinInput] = useState('');
            const [showPinModal, setShowPinModal] = useState(false);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const [selection, setSelection] = useState({ services: [], date: '', time: '', name: '', phone: '' });
            const [newService, setNewService] = useState({ name: '', price: '', duration: '' });

            const fetchData = useCallback(async () => {
                try {
                    const [resBookings, resServices, resSettings] = await Promise.all([
                        client.from('bookings').select('*').order('date', { ascending: true }),
                        client.from('services').select('*'),
                        client.from('settings').select('*').eq('id', 'global').maybeSingle()
                    ]);

                    setBookings(resBookings.data || []);
                    setServices(resServices.data || []);
                    if (resSettings.data) setConfig(resSettings.data);
                } catch (err) {
                    setError("Erro ao carregar dados do servidor.");
                }
            }, []);

            useEffect(() => {
                fetchData();
                
                // Realtime Subscriptions
                const channel = client.channel('db-all-changes')
                    .on('postgres_changes', { event: '*', schema: 'public' }, fetchData)
                    .subscribe();

                return () => client.removeChannel(channel);
            }, [fetchData]);

            // L√≥gica de Gera√ß√£o de Hor√°rios
            const timeSlots = useMemo(() => {
                const slots = [];
                const start = parseInt((config.openTime || '09:00').split(':')[0]);
                const end = parseInt((config.closeTime || '19:00').split(':')[0]);
                
                for (let i = start; i < end; i++) {
                    slots.push(`${i.toString().padStart(2, '0')}:00`);
                }
                return slots;
            }, [config.openTime, config.closeTime]);

            const getVagasDisponiveis = (date, time) => {
                const ocupados = bookings.filter(b => b.date === date && b.time === time).length;
                const totalCadeiras = Number(config.maxPerSlot) || 2;
                return totalCadeiras - ocupados;
            };

            const toggleService = (s) => {
                setSelection(prev => {
                    const exists = prev.services.find(item => item.id === s.id);
                    if (exists) {
                        return { ...prev, services: prev.services.filter(item => item.id !== s.id) };
                    } else {
                        return { ...prev, services: [...prev.services, s] };
                    }
                });
            };

            const totalSelection = useMemo(() => {
                return selection.services.reduce((acc, s) => {
                    const price = parseFloat(s.price.replace(/[^\d,.]/g, '').replace(',', '.'));
                    return acc + (isNaN(price) ? 0 : price);
                }, 0);
            }, [selection.services]);

            // L√≥gica Central de Redirecionamento WhatsApp
            const handleWhatsAppRedirect = () => {
                // Limpar o n√∫mero cadastrado de qualquer caractere n√£o num√©rico
                const rawNumber = config.whatsapp.replace(/\D/g, '');
                
                // Se o n√∫mero come√ßar com 55, usamos como est√°, sen√£o adicionamos o prefixo
                const finalNumber = rawNumber.startsWith('55') ? rawNumber : `55${rawNumber}`;
                
                const servicesText = selection.services.map(s => s.name).join(", ");
                const msg = `Ol√°! Fiz um agendamento na Don Barber:\n\n‚úÇ Servi√ßos: ${servicesText}\nüìÖ Data: ${selection.date}\n‚è∞ Hora: ${selection.time}\nüë§ Nome: ${selection.name}\nüí∞ Total: R$ ${totalSelection.toFixed(2)}`;
                
                window.open(`https://wa.me/${finalNumber}?text=${encodeURIComponent(msg)}`, '_blank');
            };

            const handleBookingSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    const serviceSummary = {
                        items: selection.services.map(s => ({ name: s.name, price: s.price })),
                        total: totalSelection
                    };

                    const { error } = await client.from('bookings').insert([{
                        name: selection.name,
                        phone: selection.phone,
                        date: selection.date,
                        time: selection.time,
                        service: serviceSummary
                    }]);

                    if (error) throw error;
                    setStep(5);
                } catch (err) {
                    setError("Erro ao salvar agendamento.");
                } finally {
                    setLoading(false);
                }
            };

            const updateSettings = async (updates) => {
                const newConfig = { ...config, ...updates };
                setConfig(newConfig);
                await client.from('settings').upsert({ id: 'global', ...newConfig });
            };

            const deleteBooking = async (id) => {
                await client.from('bookings').delete().eq('id', id);
                fetchData();
            };

            return (
                <div className="min-h-screen flex flex-col pb-24 max-w-[600px] mx-auto bg-zinc-950 border-x border-white/5 shadow-2xl relative">
                    
                    <header className="px-6 pt-8 pb-4 bg-zinc-900/50 sticky top-0 z-40 backdrop-blur-md border-b border-white/5">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="p-2.5 bg-amber-500 rounded-xl text-black shadow-lg shadow-amber-500/20">
                                    <Icon name="scissors" size={24} />
                                </div>
                                <div>
                                    <h1 className="text-xl font-black italic uppercase tracking-tighter leading-none text-white">Don <span className="text-amber-500">Barber</span></h1>
                                    <span className="text-[10px] font-bold text-amber-500/50 tracking-widest uppercase block mt-1">
                                        {view === 'user' ? 'Reserva Online' : 'Controlo Staff'}
                                    </span>
                                </div>
                            </div>
                            {view === 'admin' && (
                                <button onClick={() => setView('user')} className="p-2 bg-zinc-800 rounded-full text-zinc-400 hover:text-white transition-all">
                                    <Icon name="log-out" size={18} />
                                </button>
                            )}
                        </div>
                    </header>

                    <main className="flex-1 px-4 py-6">
                        {error && (
                            <div className="mb-6 p-4 bg-red-500/10 border border-red-500/20 rounded-2xl text-red-400 text-xs fade-in flex justify-between items-center">
                                <span>{error}</span>
                                <button onClick={() => setError(null)}><Icon name="x" size={14}/></button>
                            </div>
                        )}

                        {view === 'user' ? (
                            <div className="fade-in">
                                <div className="bg-zinc-900/40 rounded-[2.5rem] border border-zinc-800/50 p-6 shadow-2xl backdrop-blur-sm">
                                    
                                    {config.isManualClosed ? (
                                        <div className="text-center py-20 animate-in zoom-in">
                                            <Icon name="door-closed" size={64} className="text-red-500 mx-auto mb-6" />
                                            <h2 className="text-2xl font-black uppercase italic text-white mb-2 tracking-tighter">Estamos Fechados</h2>
                                            <p className="text-zinc-500 text-sm max-w-[200px] mx-auto">De momento a loja est√° fechada. Tente novamente mais tarde!</p>
                                        </div>
                                    ) : (
                                        <>
                                            {/* Passo 1: Servi√ßos */}
                                            {step === 1 && (
                                                <div className="space-y-4">
                                                    <h2 className="text-xl font-black italic uppercase text-white px-2 tracking-tighter">O que vamos fazer?</h2>
                                                    <div className="grid gap-3">
                                                        {services.map(s => {
                                                            const isSelected = selection.services.find(item => item.id === s.id);
                                                            return (
                                                                <button key={s.id} onClick={() => toggleService(s)} 
                                                                    className={`w-full flex items-center justify-between p-5 rounded-3xl border transition-all text-left ${isSelected ? 'service-card-selected' : 'bg-zinc-800/40 border-zinc-700/50'}`}>
                                                                    <div className="flex items-center gap-4">
                                                                        <div className={`p-3 rounded-2xl transition-colors ${isSelected ? 'bg-amber-500 text-black' : 'bg-zinc-700/50 text-amber-500'}`}>
                                                                            <Icon name={isSelected ? "check" : "plus"} />
                                                                        </div>
                                                                        <div>
                                                                            <p className="font-bold text-base leading-tight text-white">{s.name}</p>
                                                                            <p className="text-xs text-zinc-500">{s.duration}</p>
                                                                        </div>
                                                                    </div>
                                                                    <span className="font-black text-amber-500">{s.price}</span>
                                                                </button>
                                                            );
                                                        })}
                                                    </div>
                                                    {selection.services.length > 0 && (
                                                        <button onClick={() => setStep(2)} className="w-full py-5 btn-primary rounded-3xl mt-4 shadow-lg shadow-amber-500/20">
                                                            Continuar (R$ {totalSelection.toFixed(2)})
                                                        </button>
                                                    )}
                                                </div>
                                            )}

                                            {step === 2 && (
                                                <div className="space-y-6 fade-in">
                                                    <h2 className="text-xl font-black italic uppercase text-white tracking-tighter">Escolha a Data</h2>
                                                    <div className="bg-zinc-800/50 p-4 rounded-3xl border border-zinc-700/50">
                                                        <input type="date" min={new Date().toISOString().split('T')[0]} 
                                                            className="w-full bg-transparent p-4 text-white text-lg font-bold outline-none [color-scheme:dark]" 
                                                            onChange={e => setSelection({...selection, date: e.target.value})} />
                                                    </div>
                                                    <button disabled={!selection.date} onClick={() => setStep(3)} className="w-full py-5 btn-primary rounded-3xl shadow-xl shadow-amber-500/20">Ver Hor√°rios</button>
                                                    <button onClick={() => setStep(1)} className="w-full text-zinc-500 text-xs font-bold uppercase pt-2">Voltar aos Servi√ßos</button>
                                                </div>
                                            )}

                                            {step === 3 && (
                                                <div className="space-y-6 fade-in">
                                                    <h2 className="text-xl font-black text-center italic uppercase text-white tracking-tighter">Hor√°rios Livres</h2>
                                                    <div className="grid grid-cols-2 gap-3">
                                                        {timeSlots.map(t => {
                                                            const vagas = getVagasDisponiveis(selection.date, t);
                                                            const esgotado = vagas <= 0;
                                                            return (
                                                                <button key={t} disabled={esgotado} onClick={() => {setSelection({...selection, time: t}); setStep(4)}} 
                                                                    className={`py-5 rounded-2xl border font-black relative transition-all ${esgotado ? 'bg-zinc-950 border-zinc-900 text-zinc-800' : 'bg-zinc-800/80 border-zinc-700/50 text-white active:bg-amber-500 active:text-black'}`}>
                                                                    {t}
                                                                    {!esgotado && <span className="absolute top-1 right-2 text-[7px] text-amber-500 uppercase font-black">{vagas} vagas</span>}
                                                                    {esgotado && <span className="absolute inset-0 flex items-center justify-center bg-black/40 text-[8px] rounded-2xl opacity-50 uppercase">Esgotado</span>}
                                                                </button>
                                                            );
                                                        })}
                                                    </div>
                                                    <button onClick={() => setStep(2)} className="w-full text-zinc-500 text-xs font-bold uppercase pt-4">Escolher Outro Dia</button>
                                                </div>
                                            )}

                                            {step === 4 && (
                                                <form onSubmit={handleBookingSubmit} className="space-y-6 fade-in">
                                                    <h2 className="text-xl font-black italic uppercase text-white tracking-tighter">Seus Dados</h2>
                                                    <div className="space-y-4">
                                                        <input required placeholder="Nome Completo" className="w-full bg-zinc-800/80 p-5 rounded-2xl border border-zinc-700/50 outline-none focus:border-amber-500 text-white" 
                                                            onChange={e => setSelection({...selection, name: e.target.value})} />
                                                        
                                                        <input required type="tel" placeholder="WhatsApp (DDD + N√∫mero)" className="w-full bg-zinc-800/80 p-5 rounded-2xl border border-zinc-700/50 outline-none focus:border-amber-500 text-white" 
                                                            value={selection.phone} onChange={e => setSelection({...selection, phone: e.target.value.replace(/\D/g, '').slice(0,11)})} />
                                                    </div>
                                                    
                                                    <div className="p-5 bg-amber-500/5 rounded-3xl border border-amber-500/10 text-sm">
                                                        <p className="text-zinc-500 uppercase font-black text-[10px] mb-2 tracking-widest">Resumo</p>
                                                        <p className="text-white font-bold italic">{selection.date} √†s {selection.time}</p>
                                                        <p className="text-amber-500 font-black text-lg">Total: R$ {totalSelection.toFixed(2)}</p>
                                                    </div>

                                                    <button type="submit" disabled={loading || selection.phone.length < 10 || !selection.name} className="w-full py-5 btn-primary rounded-3xl shadow-xl">
                                                        {loading ? 'A Gravar...' : 'Confirmar Agendamento'}
                                                    </button>
                                                </form>
                                            )}

                                            {step === 5 && (
                                                <div className="text-center py-10 fade-in">
                                                    <Icon name="check-circle" size={80} className="text-green-500 mx-auto mb-6" />
                                                    <h2 className="text-3xl font-black uppercase italic text-white mb-2 tracking-tighter">Agendado!</h2>
                                                    <p className="text-zinc-500 text-sm mb-8">Confirmamos o teu lugar na cadeira. Vemo-nos em breve!</p>
                                                    
                                                    <button onClick={handleWhatsAppRedirect} className="w-full py-5 bg-[#25D366] text-white font-black rounded-3xl flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-all">
                                                        <Icon name="message-circle" /> Avisar no WhatsApp
                                                    </button>
                                                    
                                                    <button onClick={() => window.location.reload()} className="mt-8 text-zinc-600 text-[10px] font-black uppercase tracking-widest">Novo Agendamento</button>
                                                </div>
                                            )}
                                        </>
                                    )}
                                </div>
                            </div>
                        ) : (
                            /* PAINEL STAFF */
                            <div className="fade-in space-y-6 pb-12">
                                <div className="flex bg-zinc-800 p-1.5 rounded-2xl border border-zinc-700 overflow-x-auto no-scrollbar shadow-inner">
                                    {['agenda', 'servicos', 'configuracao'].map(tab => (
                                        <button key={tab} onClick={() => setAdminTab(tab)} className={`flex-1 py-3 px-4 rounded-xl font-black text-[10px] uppercase transition-all whitespace-nowrap ${adminTab === tab ? 'bg-amber-500 text-black shadow-lg shadow-amber-500/20' : 'text-zinc-500'}`}>
                                            {tab === 'configuracao' ? 'Loja' : tab}
                                        </button>
                                    ))}
                                </div>

                                {adminTab === 'agenda' && (
                                    <div className="space-y-4">
                                        <h2 className="text-xl font-black uppercase italic text-white px-2 tracking-tighter">Pr√≥ximos Clientes</h2>
                                        {bookings.length === 0 ? <p className="text-center py-20 opacity-30 text-xs italic">Nenhum agendamento registado</p> : 
                                            bookings.map(b => (
                                                <div key={b.id} className="bg-zinc-900/80 p-5 rounded-[2rem] border border-zinc-800 flex items-center justify-between shadow-lg hover:border-amber-500/20 transition-all">
                                                    <div className="flex items-center gap-4">
                                                        <div className="w-12 h-12 bg-zinc-800 rounded-2xl flex items-center justify-center text-amber-500 font-black border border-zinc-700">{b.time?.split(':')[0]}</div>
                                                        <div>
                                                            <p className="font-bold text-white uppercase text-sm leading-none">{b.name}</p>
                                                            <p className="text-[10px] text-zinc-500 mt-1 italic uppercase font-bold tracking-tighter">{b.date} ‚Ä¢ {b.time}</p>
                                                        </div>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button onClick={() => window.open(`https://wa.me/55${b.phone.replace(/\D/g,'')}?text=Ol√° ${b.name}, confirmamos o seu hor√°rio na Don Barber!`)} className="p-3 bg-green-500/10 text-green-500 rounded-2xl transition-all active:scale-90"><Icon name="message-circle" size={18}/></button>
                                                        <button onClick={() => deleteBooking(b.id)} className="p-3 bg-red-500/10 text-red-500 rounded-2xl transition-all active:scale-90"><Icon name="trash-2" size={18}/></button>
                                                    </div>
                                                </div>
                                            ))
                                        }
                                    </div>
                                )}

                                {adminTab === 'servicos' && (
                                    <div className="space-y-6">
                                        <div className="bg-zinc-900/80 p-6 rounded-[2.5rem] border border-zinc-800 space-y-4 shadow-2xl">
                                            <h3 className="text-[10px] font-black text-zinc-500 uppercase px-2 italic tracking-widest flex items-center gap-2"><Icon name="plus-circle" size={14}/> Novo Servi√ßo</h3>
                                            <input placeholder="Nome" className="w-full bg-zinc-800 p-4 rounded-2xl outline-none border border-zinc-700 text-white text-sm" value={newService.name} onChange={e => setNewService({...newService, name: e.target.value})} />
                                            <div className="grid grid-cols-2 gap-3">
                                                <input placeholder="Pre√ßo (R$)" className="w-full bg-zinc-800 p-4 rounded-2xl border border-zinc-700 text-white text-sm" value={newService.price} onChange={e => setNewService({...newService, price: e.target.value})} />
                                                <input placeholder="Tempo (min)" className="w-full bg-zinc-800 p-4 rounded-2xl border border-zinc-700 text-white text-sm" value={newService.duration} onChange={e => setNewService({...newService, duration: e.target.value})} />
                                            </div>
                                            <button onClick={async () => {
                                                if (!newService.name) return;
                                                await client.from('services').insert([newService]);
                                                setNewService({name:'', price:'', duration:''});
                                                fetchData();
                                            }} className="w-full py-4 bg-white text-black font-black rounded-2xl uppercase text-[10px] tracking-widest hover:bg-amber-500 transition-all active:scale-95">Gravar Novo Servi√ßo</button>
                                        </div>
                                        <div className="grid gap-2">
                                            {services.map(s => (
                                                <div key={s.id} className="bg-zinc-900/40 p-4 rounded-2xl border border-zinc-800 flex justify-between items-center px-6">
                                                    <span className="font-bold text-sm italic text-white">{s.name} <span className="text-amber-500 ml-2">({s.price})</span></span>
                                                    <button onClick={async () => { await client.from('services').delete().eq('id', s.id); fetchData(); }} className="text-zinc-700 hover:text-red-500 p-2"><Icon name="trash-2" size={16}/></button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {adminTab === 'configuracao' && (
                                    <div className="space-y-6 animate-in slide-in-from-bottom-4 pb-10">
                                        {/* Contacto WhatsApp */}
                                        <div className="bg-zinc-900/80 p-6 rounded-[2.5rem] border border-amber-500/20 shadow-xl space-y-4">
                                            <h3 className="text-[10px] font-black text-amber-500 uppercase flex items-center gap-2 italic tracking-widest px-2"><Icon name="phone" size={14}/> Contacto de Atendimento</h3>
                                            <div className="flex items-center gap-3">
                                                <div className="p-4 bg-zinc-800 rounded-2xl text-green-500 border border-white/5"><Icon name="message-circle" size={20} /></div>
                                                <input type="text" placeholder="Apenas DDD e N√∫mero (ex: 83996190083)" className="flex-1 bg-zinc-800 p-5 rounded-3xl border border-zinc-700 text-white font-black text-lg outline-none focus:border-amber-500 transition-all" 
                                                    value={config.whatsapp || ''} onChange={e => updateSettings({ whatsapp: e.target.value.replace(/\D/g, '').slice(0,11) })} />
                                            </div>
                                            <p className="text-[9px] text-zinc-500 italic px-4 font-medium uppercase tracking-tighter">O sistema adicionar√° o prefixo Brasil (+55) automaticamente para os links de WhatsApp.</p>
                                        </div>

                                        {/* Status de Abertura */}
                                        <div className="bg-zinc-900/80 p-6 rounded-[2.5rem] border border-zinc-800 shadow-xl flex items-center justify-between hover:border-white/10 transition-all">
                                            <div className="flex items-center gap-4">
                                                <div className={`p-4 rounded-2xl ${config.isManualClosed ? 'bg-red-500/10 text-red-500' : 'bg-green-500/10 text-green-500 shadow-lg shadow-green-500/10'}`}>
                                                    <Icon name={config.isManualClosed ? "door-closed" : "door-open"} size={28} />
                                                </div>
                                                <div>
                                                    <h3 className="font-bold text-white uppercase text-sm leading-none">Status da Loja</h3>
                                                    <p className="text-[9px] text-zinc-500 font-bold uppercase mt-1.5 tracking-tighter tracking-widest">
                                                        {config.isManualClosed ? "Fechada Manualmente" : "Aberta aos Clientes"}
                                                    </p>
                                                </div>
                                            </div>
                                            <label className="switch">
                                                <input type="checkbox" checked={config.isManualClosed || false} onChange={e => updateSettings({ isManualClosed: e.target.checked })} />
                                                <span className="slider"></span>
                                            </label>
                                        </div>

                                        {/* Vagas Simult√¢neas */}
                                        <div className="bg-zinc-900/80 p-6 rounded-[2.5rem] border border-zinc-800 shadow-xl space-y-4">
                                            <h3 className="text-[10px] font-black text-zinc-500 uppercase flex items-center gap-2 italic tracking-widest px-2"><Icon name="users" size={14}/> Vagas por Hora (Barbeiros)</h3>
                                            <div className="flex items-center gap-6 px-2">
                                                <input type="range" min="1" max="10" value={config.maxPerSlot || 2} 
                                                    onChange={e => updateSettings({ maxPerSlot: parseInt(e.target.value) })} 
                                                    className="flex-1 accent-amber-500 h-2 bg-zinc-800 rounded-lg appearance-none cursor-pointer" />
                                                <div className="text-center min-w-[40px]">
                                                    <span className="text-3xl font-black text-white">{config.maxPerSlot}</span>
                                                    <p className="text-[8px] text-zinc-600 uppercase font-black">Cadeiras</p>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Hor√°rios de Funcionamento */}
                                        <div className="bg-zinc-900/80 p-6 rounded-[2.5rem] border border-zinc-800 shadow-xl space-y-4">
                                            <h3 className="text-[10px] font-black text-zinc-500 uppercase flex items-center gap-2 italic tracking-widest px-2"><Icon name="clock" size={14}/> Hor√°rio de Funcionamento</h3>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div className="space-y-1">
                                                    <label className="text-[9px] font-bold text-zinc-600 uppercase px-4">Abertura</label>
                                                    <input type="time" className="w-full bg-zinc-800 p-4 rounded-2xl border border-zinc-700 text-white font-black text-lg outline-none [color-scheme:dark] focus:border-amber-500" 
                                                        value={config.openTime || '09:00'} onChange={e => updateSettings({ openTime: e.target.value })} />
                                                </div>
                                                <div className="space-y-1">
                                                    <label className="text-[9px] font-bold text-zinc-600 uppercase px-4">Fecho</label>
                                                    <input type="time" className="w-full bg-zinc-800 p-4 rounded-2xl border border-zinc-700 text-white font-black text-lg outline-none [color-scheme:dark] focus:border-amber-500" 
                                                        value={config.closeTime || '19:00'} onChange={e => updateSettings({ closeTime: e.target.value })} />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* Navega√ß√£o Mobile Inferior */}
                    <nav className="fixed bottom-0 left-0 right-0 bg-zinc-900/95 backdrop-blur-xl border-t border-white/5 px-10 py-5 z-50 rounded-t-[2.5rem] shadow-2xl max-w-[600px] mx-auto flex justify-between items-center">
                        <button onClick={() => {setView('user'); setStep(1)}} className={`flex flex-col items-center gap-1.5 transition-all active:scale-90 ${view === 'user' ? 'text-amber-500' : 'text-zinc-600'}`}>
                            <Icon name="home" size={24} />
                            <span className="text-[8px] font-black uppercase italic tracking-widest">In√≠cio</span>
                        </button>
                        <div className="w-px h-6 bg-zinc-800"></div>
                        <button onClick={() => setShowPinModal(true)} className={`flex flex-col items-center gap-1.5 transition-all active:scale-90 ${view === 'admin' ? 'text-amber-500' : 'text-zinc-600'}`}>
                            <Icon name="lock" size={24} />
                            <span className="text-[8px] font-black uppercase italic tracking-widest">Acesso Staff</span>
                        </button>
                    </nav>

                    {/* Modal de Seguran√ßa PIN */}
                    {showPinModal && (
                        <div className="fixed inset-0 z-[100] bg-black/95 flex items-center justify-center p-6 backdrop-blur-md animate-in fade-in duration-300">
                            <div className="w-full max-w-xs text-center space-y-8 animate-in zoom-in duration-300">
                                <div className="w-24 h-24 bg-amber-500/10 text-amber-500 rounded-[2rem] flex items-center justify-center mx-auto rotate-6 border border-amber-500/20 shadow-2xl shadow-amber-500/10">
                                    <Icon name="shield-check" size={48} />
                                </div>
                                <div className="space-y-2">
                                    <h3 className="text-2xl font-black uppercase italic text-white tracking-tighter leading-none">Restrito</h3>
                                    <p className="text-zinc-500 text-sm font-medium">Introduza o PIN da Barbearia</p>
                                </div>
                                <input type="password" inputMode="numeric" maxLength={4} autoFocus className="w-full bg-zinc-900 border border-zinc-800 rounded-3xl py-7 text-center text-5xl font-black tracking-[0.5em] outline-none text-white focus:border-amber-500 shadow-2xl transition-all" 
                                    value={pinInput} onChange={e => {
                                        setPinInput(e.target.value);
                                        if (e.target.value === ADMIN_PIN) { setView('admin'); setShowPinModal(false); setPinInput(''); fetchData(); }
                                    }} 
                                />
                                <button onClick={() => {setShowPinModal(false); setPinInput('')}} className="text-zinc-600 font-bold uppercase text-[10px] tracking-widest italic hover:text-white transition-colors">Voltar</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
